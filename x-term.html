<link rel="import" href="../polymer/polymer.html">
<script src="../xterm.js/dist/xterm.js"></script>
<script src="../javascript-detect-element-resize/detect-element-resize.js"></script>

<link rel="import" href="xterm-styles.html">

<dom-module id="x-term">
	<template>
		<style is="custom-style" include="xterm-styles">
			:host {
				display: block;
				overflow: hidden;
			}

			#terminal {
				height: 100%;
			}
		</style>
		<div id="terminal"></div>
	</template>
</dom-module>

<script>
	Polymer({
		is: 'x-term',

		properties: {},

		ready () {
			this.terminal = new Terminal()
			this.scopeSubtree(this.$.terminal, true)
			this.terminal.open(this.$.terminal)
			this.terminal.setOption('scrollback', 500)
			addResizeListener(this.$.terminal, () => this.onResize())
			this.terminal.on('data', data => this.fire('data', data))
			this.terminal.on('resize', size => this.fire('resize', size))
		},

		cols () { return this.terminal.cols },

		rows () { return this.terminal.rows },

		write (data) { this.terminal.write(data) },
		writeln (data) { this.terminal.writeln(data) },
		clear () { this.terminal.clear() },

		onResize () {
			this.terminal.charMeasure.measure()
			let charWidth = this.terminal.charMeasure.width
			let charHeight = this.terminal.charMeasure.height

			let width = this.clientWidth
			let height = this.clientHeight

			this.terminal.resize(Math.floor(width / charWidth) - 2, Math.floor(height / charHeight))
		}
	})
</script>


